<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Variable Gain Amplifier - Arterial BP Triggering</title>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script>

  <style>
    body {font-size: 90%;}
    pre, code {font-size: 100%;}
    h3, h4, h5, h6 {color: #2980b9; font-weight: 300}
  </style> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../instructions/user_manual" class="icon icon-home"> Arterial BP Triggering</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <ul class="current">
    
        
        <span>Instructions</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../instructions/user_manual">User Manual</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../instructions/guidelines-for-adapting-to-new-instrument">Guidelines for using a Different Pressure Measurement System</a>
                    
                </li>
            
        

    
        
        <span>Build Log</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../apb-triggering">Triggering Algorithm</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../set-adaptive-gain-algorithm">Gain Adjustment Algorithm</a>
                    
                </li>
            
                <li class="toctree-l1 current">
                    <a class="current" href=".">Variable Gain Amplifier</a>
                    
                        <ul>
                        
                            <li class="toctree-l2"><a href="#variable-gain-amplifier-with-spi-interface">Variable Gain Amplifier with SPI Interface</a></li>
                            
                                <li><a class="toctree-l3" href="#specifications">Specifications</a></li>
                            
                                <li><a class="toctree-l3" href="#building-blocks">Building Blocks</a></li>
                            
                        
                        </ul>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../gui-design">Monitoring Tool</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../pcb-design">PCB</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../testing-australian-data">Validation</a>
                    
                </li>
            
        

    
</ul>

      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="../../instructions/user_manual"></a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../instructions/user_manual">Docs</a> &raquo;</li>
    <li>Variable Gain Amplifier</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/JoshBradshaw/Arterial-BP-MRI-Triggering-Unit" class="icon icon-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              <h2 id="variable-gain-amplifier-with-spi-interface">Variable Gain Amplifier with SPI Interface</h2>
<p>A major problem with triggering off of the fetal blood pressures is that the signal coming from the transducers is relatively small compared to the full scale of the pressure measurement instrument (numbers given below in specifications). To resolve this issue, I considered three possible solutions:</p>
<ol>
<li>Use an analog potentiometer in the gain feedback path, which the experimenter can adjust by turning a knob.</li>
<li>Use a digital potentiometer in the feedback path which the experimenter can adjust by pressing increment and decrement buttons.</li>
<li>Use a digital potentiometer in the gain feedback path which is automatically adjusted by the microcontroller whenever the signal level is out of range.</li>
</ol>
<p>After due consideration, I opted to use strategy #3. Having the microcontroller perform the adjustment is advantageous because the microntroller can adjust the gain smoothly and gradually over a period of one minute or more, which will ensure that the gain adjustments do not interfere with the constantly running triggering algorithm.</p>
<h3 id="specifications">Specifications</h3>
<ul>
<li>The Samba Sensor can measure pressures from -38 mmHg to 263 mmHg, which is linearly mapped to a 0-5V output</li>
<li>Fetal lambs have a typical blood pressure of 70/30 mmHg, which is the best approximation we have for a fetal Yorkshire pig</li>
</ul>
<p>With the assumed blood pressure range of the pig, only 0.66V of the 5V range will be used for the signal ((70-30)/(263 - (-38))) * 5V = 0.66V. </p>
<p>Based on these estimates I calculated the minimum possible gain range to be 1x - 8x. I choose to use an upper gain value of 11x in my design, so that it will work optimally even with lower than expected blood pressures.</p>
<h3 id="building-blocks">Building Blocks</h3>
<p>I opted to use this whitepaper as the basis of my design: <a href="http://www.analog.com/en/circuits-from-the-lab/cn0112/vc.html">CN0112: Variable Gain Noninverting Amplifier Using the AD5292 Digital Potentiometer and the OP184 Op Amp</a>.</p>
<p><img alt="alt text" src="../..//images/linear_variable_gain_adjust.jpg" /></p>
<p>I chose this circuit because it offered an appropriate gain adjustment range, and because the <a href="https://www.pjrc.com/teensy/td_libs_SPI.html">teensy has an excellent high speed SPI library for sending values to the digital potentiometer</a>.</p>
<p>I started by patching up a simple non-inverting amplifier, on a breadboard like so:</p>
<p><img src="../..//images/gain_adjust_amplifier.JPG" alt="Slope Sum function applied to blood pressure waveform" style="width: 600px;"/></p>
<p>This amplifier had an adjustable gain range of 1.1 V/V to 11 V/V with 256 subdivisions. This is more than enough gain to amplify a 70/30 mmHg signal to the full range of the ADC.</p>
<p>With that all patched up and working, all that remains is to write an efficient algorithm for bringing the signal into full range in real time.</p>
<p>The algorithm development is documented in this post:</p>

            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../gui-design" class="btn btn-neutral float-right" title="Monitoring Tool"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../set-adaptive-gain-algorithm" class="btn btn-neutral" title="Gain Adjustment Algorithm"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
        
            <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
        
      <span><a href="../set-adaptive-gain-algorithm" style="color: #fcfcfc;">&laquo; Previous</a></span>
      <span style="margin-left: 15px"><a href="../gui-design" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>
</body>
</html>